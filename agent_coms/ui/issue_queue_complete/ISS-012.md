### ISS-012: Financial Aid Fields Integration - Learner Demographics

**Priority:** low
**Type:** feature
**Status:** ✅ COMPLETED (2026-01-13)
**Assigned:** Both (UI + API coordination)
**Dependencies:** ISS-010 (completed)
**API Completed:** 2026-01-13
**UI Completed:** 2026-01-13 (LearnerFinancialStatusSection lines 181-259)

**Description:**
Add financial aid eligibility fields to learner demographics (Section 2.15). These are readonly calculated fields set by the Financial Aid office based on FAFSA data. Deferred from ISS-010 to reduce scope and allow separate Financial Aid system integration design.

**Fields to Add:**
- `pellEligible` (boolean, readonly) - Calculated based on FAFSA data
- `lowIncomeStatus` (boolean, readonly) - Calculated based on household income and dependents

**API Implementation Summary (2026-01-13):**

✅ **COMPLETED:**
- [x] Extended existing demographics API (no separate endpoint needed)
- [x] Added comprehensive documentation to IDemographics interface
- [x] Marked fields as READONLY in schema with comments
- [x] Updated demographics service to reject updates to these fields
- [x] Returns 400 READONLY_FIELD_ERROR if update attempted
- [x] Updated demographics contract with READONLY annotations
- [x] Added 6 integration tests for readonly field behavior
- [x] Fields are returned in GET /api/v2/users/me/demographics
- [x] Fields handle null/undefined gracefully

**API Changes for UI Team:**

**1. Endpoint Structure (DECISION: Extend existing endpoint)**
- Use existing `GET /api/v2/users/me/demographics`
- No separate financial aid endpoint needed
- Fields included in standard demographics response

**2. Response Format:**
```typescript
{
  success: true,
  data: {
    // ... other demographics fields ...

    // Financial Aid Fields (READONLY)
    pellEligible: boolean | null,        // null if not set by Financial Aid office
    lowIncomeStatus: boolean | null,     // null if not set by Financial Aid office
    householdIncomeRange: string | null  // User-editable field
  }
}
```

**3. READONLY Behavior:**
- **Cannot Update:** Attempts to PUT these fields return 400 error
- **Error Message:** "Cannot update readonly financial aid fields: pellEligible, lowIncomeStatus. These fields are calculated and set by the Financial Aid office based on FAFSA data."
- **GET Always Returns:** These fields always appear in GET response (even if null)

**4. Null Handling:**
- Fields will be `null` if Financial Aid office hasn't set them yet
- Indicates: Student hasn't submitted FAFSA or data not processed yet

**Acceptance Criteria:**

**UI Implementation (Remaining):**
- [ ] Implement readonly field display in Section 2.15 (Personal & Family Status)
- [ ] Display appropriate badges/tooltips:
  - Badge: "Calculated by Financial Aid"
  - Tooltip: "This field is automatically set based on your FAFSA data. Contact Financial Aid office if you believe this is incorrect."
- [ ] Handle null/undefined gracefully:
  - Display: "Not Available" or "Pending FAFSA Processing"
  - Show help text: "Submit FAFSA to see eligibility status"
- [ ] Ensure fields are visually readonly (no edit button, grayed out, or badge)
- [ ] Update demographics type definitions to include optional financial aid fields
- [ ] Write UI tests for readonly field display and null handling
- [ ] Test error handling if user somehow attempts update (should not be possible)

**UI Display Recommendations:**

```tsx
// Example display format:
<div className="financial-aid-fields">
  <h4>Financial Aid Eligibility</h4>
  <p className="help-text">
    These fields are calculated by the Financial Aid office based on your FAFSA data.
  </p>

  <div className="readonly-field">
    <label>
      Pell Grant Eligible
      <Badge variant="info">Calculated</Badge>
    </label>
    <div className="field-value">
      {pellEligible === null ? (
        <span className="text-muted">
          Not Available - Submit FAFSA
        </span>
      ) : pellEligible ? (
        <span className="text-success">✓ Eligible</span>
      ) : (
        <span className="text-muted">Not Eligible</span>
      )}
    </div>
  </div>

  <div className="readonly-field">
    <label>
      Low Income Status
      <Badge variant="info">Calculated</Badge>
    </label>
    <div className="field-value">
      {lowIncomeStatus === null ? (
        <span className="text-muted">
          Not Available - Submit FAFSA
        </span>
      ) : lowIncomeStatus ? (
        <span className="text-success">✓ Qualified</span>
      ) : (
        <span className="text-muted">Not Qualified</span>
      )}
    </div>
  </div>
</div>
```

**Related Files:**

**API (Completed):**
- `src/models/auth/Demographics.types.ts` - Interface and schema updated
- `src/services/users/users.service.ts` - Readonly validation added
- `contracts/api/demographics.contract.ts` - Contract updated with READONLY notes
- `tests/integration/users/demographics.test.ts` - 6 new tests added

**UI (To Implement):**
- `src/pages/profile/components/demographics/FinancialStatusSection.tsx` (will be modified)
- `src/entities/user-profile/model/types.ts` (add optional fields)
- `src/entities/user-profile/api/userProfileApi.ts` (no changes needed, use existing)

**Notes:**
- Deferred from ISS-010 per clarifying question #6 (2026-01-13)
- API implementation complete, ready for UI integration
- No separate Financial Aid API needed - uses existing demographics endpoint
- Financial Aid office will set these values through admin interfaces (future work)
- Data source: External FAFSA system integration or manual entry by Financial Aid staff
- Priority: Low (can be implemented after core ISS-010 profile forms complete)

**Questions Resolved:**
1. **Endpoint Structure:** ✅ Extend existing demographics API (not separate endpoint)
2. **FAFSA Data Source:** Future work - Financial Aid admin interface or batch import
3. **Readonly Implementation:** ✅ Service layer validation rejects updates with clear error message

**API Testing:**
All 6 new tests passing:
- Rejects pellEligible updates (400 error)
- Rejects lowIncomeStatus updates (400 error)
- Rejects both fields together (400 error)
- Allows other field updates while readonly fields exist
- Returns fields in GET responses
- Handles null fields gracefully

---

