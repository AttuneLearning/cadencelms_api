# UI Team → API Team: ISS-021 Contract Change Request

**Date:** 2026-01-14 16:00  
**From:** UI Team  
**To:** API Team  
**Type:** Contract Change Request  
**Priority:** High  
**Issue:** ISS-021 - Role Permission Updates

---

## Summary

Requesting API contract changes to support two new role capabilities:
1. **Grade Override** for dept-admin (new endpoint)
2. **Course View** for billing-admin (capability update)

---

## Request 1: Grade Override Endpoint

### New Endpoint Required

```
PUT /api/v1/enrollments/:enrollmentId/grades/:gradeId/override
```

### Purpose

Allow dept-admin to correct/modify student grades after initial grading, with mandatory audit logging.

### Request Body

```typescript
interface GradeOverrideRequest {
  newValue: number;           // The corrected grade value
  reason: string;             // Required: explanation for override
  previousValue?: number;     // Optional: for validation
}
```

### Expected Response

```typescript
interface GradeOverrideResponse {
  success: boolean;
  gradeId: string;
  enrollmentId: string;
  previousValue: number;
  newValue: number;
  overrideBy: string;         // User ID who made the change
  overrideAt: string;         // ISO timestamp
  reason: string;
  changeLogId: string;        // Reference to audit log entry
}
```

### Authorization

- Required capability: `grade:override`
- Only dept-admin role should have this capability
- Must validate user has dept-admin role in the course's department

### Audit Requirements

**CRITICAL:** Every grade override MUST create an audit log entry with:
- Previous value
- New value
- Timestamp
- User ID of admin making change
- Reason provided
- Course, enrollment, and learner context

### Error Cases

| Status | Condition |
|--------|-----------|
| 401 | Not authenticated |
| 403 | Missing `grade:override` capability |
| 404 | Grade or enrollment not found |
| 422 | Reason field empty or missing |
| 422 | newValue out of valid range |

---

## Request 2: Billing-Admin Course View Capability

### Change Required

Update `billing-admin` role capability from `course:view:financial` to `course:view`.

### Affected Endpoints

| Endpoint | Current Access | Requested Access |
|----------|---------------|------------------|
| `GET /api/v1/courses` | ❌ (billing-admin) | ✅ |
| `GET /api/v1/courses/:id` | ❌ (billing-admin) | ✅ |

### Purpose

Allow billing-admin to view course list and details for:
- Correlating revenue reports with specific courses
- Understanding course pricing in context
- Cross-referencing financial data

### Restrictions (No Change)

billing-admin should still NOT have access to:
- Course editing (`PUT /api/v1/courses/:id`)
- Module management (`/api/v1/courses/:id/modules/*`)
- Content operations

### Implementation

Option A: Add `course:view` to billing-admin capabilities in ROLE_CAPABILITIES  
Option B: Check for either `course:view` OR `billing-admin` role on course list/detail endpoints

Recommend **Option A** for consistency with additive model.

---

## ROLE_CAPABILITIES Update

Please update the capability mapping:

```typescript
// Current
'billing-admin': [
  'course:view:financial',  // Remove this
  'revenue:view',
  // ...
],

// Updated
'billing-admin': [
  'course:view',            // Add this (full course view)
  'revenue:view',
  // ...
],

// Add to dept-admin
'dept-admin': [
  // existing...
  'grade:override',         // NEW: grade correction capability
],
```

---

## Timeline Request

- Contract confirmation needed before UI implementation planning
- No blocking urgency, but please confirm feasibility

---

## Questions for API Team

1. Is there an existing grade change audit table, or will one need to be created?
2. Any preference on the grade override endpoint path structure?
3. Are there any existing validation rules for grade values (min/max, decimal precision)?

---

**Awaiting Response**

Please reply with:
- [ ] Contract approved as proposed
- [ ] Contract approved with modifications (specify)
- [ ] Questions/concerns before approval
- [ ] Estimated implementation timeline

---

**Reference:** [ISS-021.md](../ui/issue_queue/ISS-021.md)
