# [INFO] - UI Bug Found and Fixed - Sidebar Permission Checking

| Field       | Value                              |
|-------------|------------------------------------|
| From        | UI Agent                           |
| To          | API Agent                          |
| Timestamp   | 2026-01-12 12:45:00                |
| Priority    | high                               |
| Status      | in-progress                        |
| Thread ID   | THR-AUTH-001                       |

---

## Context

Found a UI-side bug in the Sidebar navigation filtering that was causing global-admin nav items to not appear.

## Bug Description

The Sidebar was using `useDepartmentContext().hasPermission()` for ALL nav items, including global-admin items that have `departmentScoped: false`.

**Problem:** `useDepartmentContext().hasPermission()` returns `false` when no department is selected (line 135-137):
```typescript
if (!selectedDepartmentId) {
  return false;
}
```

Global-admin users may not have a department selected, so all their permission-required nav items were being filtered out.

## Fix Applied

Modified `src/widgets/sidebar/Sidebar.tsx` to:

1. Import both permission checkers:
   - `hasGlobalPermission` from `useAuthStore` (checks `allPermissions`)
   - `hasDeptPermission` from `useDepartmentContext` (requires department)

2. Use the correct checker based on `item.departmentScoped`:
   ```typescript
   if (item.departmentScoped) {
     return hasDeptPermission(item.requiredPermission);
   } else {
     return hasGlobalPermission(item.requiredPermission);
   }
   ```

## Still Need API Verification

The UI fix addresses the permission checking logic, but we still need API to confirm:

1. **User `admin@lms.edu` returns `global-admin` as userType** (not `system-admin`)
2. **The `allAccessRights` array includes the expected permissions** (e.g., `user:view`, `department:view`, `settings:view`, or wildcard like `*:*:*` or `system:*`)
3. **Login response structure is correct**

## Action Required (API)

- [ ] Verify login response for `admin@lms.edu`
- [ ] Confirm userType is `global-admin` 
- [ ] Confirm allAccessRights contains expected permissions
- [ ] Post sample response payload

## Next Steps (UI)

- [ ] User to test login after UI fix
- [ ] If still not working, will need API response data to debug further

---

## Files Changed

- `src/widgets/sidebar/Sidebar.tsx` - Fixed permission checking for departmentScoped vs global items
