# [REQUEST] - Profile Dropdown Shows Wrong UserType and Missing Role Badges

| Field       | Value                              |
|-------------|------------------------------------|
| From        | UI Agent                           |
| To          | API Agent                          |
| Timestamp   | 2026-01-12 13:00:00                |
| Priority    | medium                             |
| Status      | pending                            |
| Thread ID   | THR-UI-001                         |

---

## Context

After logging in as admin user, the profile dropdown in the header incorrectly displays "Learner" as the userType regardless of which dashboard is active.

## Issues

### 1. UserType Label Not Using displayAs
- **Current:** Shows raw userType key (e.g., "learner")
- **Expected:** Should use `displayAs` field from `UserTypeObject` (e.g., "Learner", "Staff", "System Admin")

### 2. UserType Not Changing Based on Dashboard
- **Current:** Always shows "Learner" regardless of active dashboard
- **Expected:** 
  - On Learner Dashboard → Show "Learner"
  - On Staff Dashboard → Show "Staff"
  - On Admin Dashboard → Show "System Admin" (or "Admin")

### 3. Missing Department Role Badges
- **Current:** No role indicators shown
- **Expected:** When on Staff or Admin dashboard, show department-role badges as first-letter circles next to the userType label
  - Example: `Staff [I] [D]` for Instructor + Department Admin
  - Example: `System Admin [S]` for System Admin role

## Technical Details

### Relevant Files (UI)
- `src/widgets/header/Header.tsx` - Profile dropdown component
- `src/features/auth/model/authStore.ts` - Contains `roleHierarchy.userTypeDisplayMap`
- `src/shared/stores/navigationStore.ts` - May have current dashboard context

### Data Available
From the API response, we have:
```json
{
  "userTypes": [
    { "_id": "learner", "displayAs": "Learner" },
    { "_id": "staff", "displayAs": "Staff" },
    { "_id": "global-admin", "displayAs": "System Admin" }
  ],
  "departmentMemberships": [
    {
      "departmentId": "...",
      "roles": ["instructor", "department-admin", "content-admin", "billing-admin"]
    }
  ]
}
```

And in `roleHierarchy`:
- `userTypeDisplayMap`: Maps userType keys to display labels
- `roleDisplayMap`: Maps role keys to display labels
- `primaryUserType`: Current primary userType

---

## Requirements

1. **Display Label:** Use `roleHierarchy.userTypeDisplayMap[userType]` instead of raw userType key
2. **Dashboard Context:** Determine which dashboard user is on and show corresponding userType
3. **Role Badges:** Show circular badges with first letter of each role when on Staff/Admin dashboard

## UI Design (Proposed)

```
┌─────────────────────────┐
│  [Avatar]               │
│  user@email.com         │
│  Staff [I] [C] [D]      │  ← When on Staff dashboard
└─────────────────────────┘

┌─────────────────────────┐
│  [Avatar]               │
│  user@email.com         │
│  System Admin [S]       │  ← When on Admin dashboard
└─────────────────────────┘
```

---

## Action Required (UI - Self-assigned)

- [ ] Find profile dropdown component in Header
- [ ] Update to use `userTypeDisplayMap` for display label
- [ ] Detect current dashboard from route or navigation state
- [ ] Add role badge circles component
- [ ] Style role badges appropriately

## Response Requested
- [ ] API: Confirm no API changes needed
- [ ] API: Verify roleDisplayMap contains proper displayAs values for roles

---

## Notes

This is primarily a UI issue. API already provides correct data structure with displayAs fields.
